{% extends "syncapp/base.html" %}
{% load static %}

{% block title %}Add Produce{% endblock %}

{% block content %}

<div class="container my-5">
  <div class="card shadow-sm mx-auto" style="max-width: 600px;">
    <div class="card-body">
      <h3 class="card-title text-center mb-4">Welcome {{ thela_username }}<br>Add Produce Details</h3>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        {{ form.as_p }}

        
        <div class="d-grid mt-3">
          <button type="submit" class="btn btn-success btn-block">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  body {
    background-color: #f7f9fc;
  }
  .card {
    border-radius: 1rem;
  }
  input, select, textarea {
    border-radius: 0.5rem !important;
  }
  @media (max-width: 576px) {
    .card {
      margin: 10px;
    }
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const latInput = document.getElementById("id_latitude");
  const lonInput = document.getElementById("id_longitude");
  // const status = document.getElementById("locationStatus");

  // Try auto location
  navigator.geolocation.getCurrentPosition(
    function (pos) {
      latInput.value = pos.coords.latitude.toFixed(7);
      lonInput.value = pos.coords.longitude.toFixed(7);
      
    },
    function () {
      // fallback values
      latInput.value = "0.0000000";
      lonInput.value = "0.0000000";
    }
  );

  
  // Commodity dropdown logic (unchanged)
  const select = document.getElementById("id_sale_commodity");
  if (select) {
    select.addEventListener("change", () => {
      if (select.value === "add_new") {
        const newCommodity = prompt("Enter the new commodity name:");
        if (newCommodity) {
          const option = new Option(newCommodity, newCommodity.toLowerCase(), true, true);
          select.add(option);
        } else {
          select.value = "";
        }
      }
    });
  }
});
</script>
{% endblock %}
